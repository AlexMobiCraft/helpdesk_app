**Этап 1: Подготовка и Основа Бэкенда (FastAPI & PostgreSQL)**

1.  **Настройка Окружения:**
    *   Создание структуры проекта FastAPI.
    *   Настройка виртуального окружения и установка зависимостей (FastAPI, Uvicorn, SQLAlchemy/asyncpg, Pydantic, passlib, python-jose[cryptography] и т.д.).
    *   Настройка и запуск базы данных PostgreSQL в Docker.
    *   Настройка инструмента миграций БД Alembic.
2.  **Модели Базы Данных:**
    *   Определение SQLAlchemy моделей для всех таблиц, указанных в ТЗ (`users`, `user_roles`, `tickets`, `devices`, `device_types`, `priorities`, `statuses`, `files`, `technician_assignments`).
    *   Создание и применение начальных миграций для создания схемы БД.
    *   Создания начальных данных справочников и пользователя-администратора.
3.  **Аутентификация: [x]**
    *   [x] Реализация хэширования паролей при создании/обновлении пользователя (используя `passlib` и `bcrypt` в `app/core/security.py`, применение при создании/обновлении будет в п.6).
    *   [x] Реализация эндпоинта `/api/auth/login` (Эндпоинт #1) для выдачи JWT-токенов (в `app/api/v1/endpoints/auth.py`, использует `OAuth2PasswordRequestForm`, `python-jose` для JWT).
    *   [x] Создание FastAPI зависимостей (dependencies) для проверки JWT-токенов и получения текущего пользователя (`get_current_user` в `app/core/dependencies.py`) и эндпоинта `/api/users/me` (Эндпоинт #2) (в `app/api/v1/endpoints/users.py`).
4.  **Управление Справочниками (Admin CRUD): [x]**
    *   Реализация CRUD-эндпоинтов для администратора:
        *   Типы устройств (`/api/admin/device-types` - Эндпоинты #27, #28, #29, #30, #31).
        *   Приоритеты (`/api/admin/priorities` - Эндпоинты #37, #38, #39, #40, #41).
        *   Статусы (`/api/admin/statuses` - Эндпоинты #42, #43, #44, #45, #46).
        *   Роли пользователей (`/api/admin/roles` - Эндпоинты #22, #23, #24, #25, #26).
    *   Реализация эндпоинтов для получения списков справочников всеми пользователями (`/api/device-types`, `/api/priorities`, `/api/statuses`, `/api/admin/roles` - только админ).
5.  **Управление Устройствами (Admin CRUD): [x]**
    *   Реализация CRUD-эндпоинтов для администратора (`/api/admin/devices` - Эндпоинты #32, #35, #36).
    *   Реализация эндпоинта получения списка устройств всеми пользователями (`/api/devices` - Эндпоинт #33).
    *   Реализация эндпоинта получения информации о конкретном устройстве всеми пользователями (`/api/devices/{device_id}` - Эндпоинт #34).
6.  **Управление Пользователями (Admin CRUD): [x]**
    *   Реализация CRUD-эндпоинтов для администратора (`/api/admin/users` - Эндпоинты #15, #16, #17, #18 (admin), #21).
    *   Реализация эндпоинта обновления данных для текущего пользователя (`/api/users/me` - Эндпоинт #18 (user)).
    *   Реализация эндпоинта смены пароля текущим пользователем (`/api/users/me/password` - Эндпоинт #19)
    *   Реализация эндпоинта установки/сброса пароля пользователя администратором (`/api/admin/users/{user_id}/password` - Эндпоинт #20)
    *   Реализация эндпоинта изменения роли пользователя администратором (`/api/admin/users/{user_id}/role` - Эндпоинт #21)
    *   Реализация эндпоинта изменение роли пользователя (`/api/admin/users/{user_id}/role` - Эндпоинт #48).


**Этап 2: Основная Логика Заявок (Бэкенд)**

1.  **Создание и Просмотр Заявок:[x]**
    *   Реализация эндпоинта создания заявки пользователем (`/api/tickets` - Эндпоинт #3). *Учесть автоматическое проставление `user_id`, `created_at`, начального `status_id`.*
    *   Реализация эндпоинта получения списка заявок (`/api/tickets` - Эндпоинт #4) с пагинацией, фильтрацией и сортировкой.
    *   Реализация эндпоинта получения деталей заявки (`/api/tickets/{ticket_id}` - Эндпоинт #5) с подгрузкой связанных данных (пользователь, устройство, статус, приоритет, файлы, техники).
2.  **Обновление и Статусы Заявок:[x]**
    *   Реализация эндпоинта частичного обновления заявки (`/api/tickets/{ticket_id}` - Эндпоинт #6). *Учесть права доступа на изменение полей.*
    *   Реализация эндпоинта смены статуса заявки (`/api/tickets/{ticket_id}/status` - Эндпоинт #7). *Учесть логику смены статусов и права (техник/админ).*
    *   Реализация логики редактирования закрытой заявки (`/api/tickets/{ticket_id}/edit-closed` - Эндпоинт #10).
3.  **Назначение Техников:[x]**
    *   Реализация эндпоинтов назначения/снятия техников (`/api/tickets/{ticket_id}/assign`, `/api/tickets/{ticket_id}/unassign/{technician_id}` - Эндпоинты #8, #9).
4.  **Работа с Файлами:[x]**
    *   Настройка хранения файлов (локально для разработки, облачное хранилище для продакшена).
    *   Реализация эндпоинтов загрузки и удаления файлов к заявке (`/api/tickets/{ticket_id}/files`, `/api/tickets/{ticket_id}/files/{file_id}` - Эндпоинты #11, #12).
5.  **Дополнительные Функции (Admin):[x]**
    *   Реализация эндпоинта удаления заявки администратором (`/api/tickets/{ticket_id}` - Эндпоинт #13).
    *   Реализация эндпоинта создания заявки от имени пользователя (`/api/admin/tickets` - Эндпоинт #14).
6.  **Отчеты (Admin):[x]**
    *   Реализация эндпоинта экспорта отчетов по заявкам (`/api/admin/reports/tickets` - Эндпоинт #47).

**Этап 3: Основа Фронтенда (Next.js)**

1.  **Настройка Окружения:[x]**
    *   Инициализация проекта Next.js (с TypeScript, если планируется).
    *   Настройка PWA (манифест, сервис-воркер).
    *   Выбор и интеграция UI-библиотеки (Material UI, Ant Design, Chakra UI, Tailwind CSS + Headless UI и т.д.).
    *   Настройка линтеров и форматтеров (ESLint, Prettier).
2.  **Структура и Роутинг:[x]**
    *   Определение основной структуры папок.
    *   Настройка базовых лейаутов (например, основной, админ-панель).
    *   Настройка роутинга Next.js для основных страниц.
3.  **Аутентификация:[x]**
    *   Создание страницы входа (`/login`).
    *   Реализация логики взаимодействия с бэкенд-эндпоинтом `/api/auth/login`.
    *   Безопасное хранение JWT-токена (например, в httpOnly cookie или LocalStorage с мерами предосторожности).
    *   Настройка отправки токена в заголовках `Authorization` для защищенных запросов.
    *   Реализация логики получения данных текущего пользователя (`/api/users/me`).
    *   Создание защищенных роутов (перенаправление на `/login`, если не аутентифицирован).
4.  **Состояние и API-клиент:[x]**
    *   Выбор и настройка решения для управления состоянием (Zustand).
    *   Настройка централизованного способа взаимодействия с API (с использованием `axios`, `react-query`/`swr`).

**Этап 4: Реализация Интерфейсов (Фронтенд)**

1. **Отображение данных**
   - Реализация страниц для просмотра списков: заявок, пользователей (админ), устройств, справочников (приоритеты, статусы, типы устройств, роли).
   - Интеграция с соответствующими GET-эндпоинтами бэкенда, включая пагинацию, фильтры, сортировку.
   - Реализация страницы детального просмотра заявки (отдельный маршрут, отображение всех связанных данных: история, файлы, комментарии, назначенные техники и т.д.).
   - Использование React Query для загрузки и кэширования данных списков, автоматическое обновление при изменениях.
   - Унификация таблиц через переиспользуемые компоненты (например, DataGrid с поддержкой фильтров и действий).

2. **Формы и взаимодействие**
   - Создание форм для:
     - Создания заявки (пользователь).
     - Редактирования заявки (обновление описания, приоритета).
     - Смены статуса заявки (техник/админ).
     - Добавления комментариев к закрытой заявке (техник/админ).
     - Назначения техников (админ/техник).
     - Загрузки файлов к заявке.
     - Создания/редактирования пользователей, устройств, справочников (включая роли) (админ).
   - Подключение форм к соответствующим POST/PATCH/PUT/DELETE эндпоинтам бэкенда.
   - Поддержка валидации форм (frontend + обработка ошибок backend).
   - Использование модальных окон для создания/редактирования записей.
   - Информирование пользователя о результате операций (успех, ошибка).

3. **Управление доступом (UI)**
   - Динамическое отображение/скрытие элементов интерфейса и доступных действий в зависимости от роли пользователя (`user`, `technician`, `admin`).
   - Реализация защищённых маршрутов (ProtectedRoute) для административных страниц.
   - Проверка роли пользователя через хук useCurrentUser (React Query).
   - Автоматический редирект на /login при отсутствии авторизации или недостатке прав.

4. **Управление состоянием и UX**
   - Использование React Query для работы с данными (CRUD-операции, кэширование, автоматическое обновление).
   - Использование Zustand для UI-состояний (открытие/закрытие модалок, сайдбар, тема и т.д.).
   - Реализация индикаторов загрузки, skeleton-элементов, уведомлений об ошибках.
   - Поддержка адаптивности интерфейса (responsive дизайн для мобильных/планшетов).
   - Локализация интерфейса (если требуется).

5. **Тестирование и отладка**
   - Покрытие основных пользовательских сценариев ручными и, по возможности, автотестами (unit, e2e).
   - Проверка граничных случаев: пустые списки, ошибки API, отсутствие прав, невалидные данные.
   - Тестирование UX: сообщения об ошибках, подтверждения удаления, индикаторы загрузки.

6. **Документирование**
   - Описание структуры страниц и компонентов.
   - Документация по использованию хуков, API-клиентов, особенностей работы с правами доступа.
   - Комментарии в коде для сложных решений.

7.  **Локализация:**
    *   Интеграция библиотеки i18next.
    *   Создание файлов с переводами для поддерживаемых языков.
    *   Реализация переключения языка в интерфейсе.

**Этап 5: Тестирование, PWA и Развертывание**

1.  **Тестирование:**
    *   Написание Unit-тестов (для бэкенда и фронтенда).
    *   Написание Integration-тестов (для бэкенда).
    *   Написание E2E-тестов (например, с использованием Cypress или Playwright).
2.  **PWA:**
    *   Настройка стратегий кэширования для оффлайн-работы (например, кэширование статики, API-запросов).
    *   Тестирование оффлайн-режима.
3.  **Сборка и Развертывание:**
    *   Настройка сборки продакшен-версии фронтенда и бэкенда.
    *   Подготовка Dockerfile для контейнеризации приложения (бэкенд, фронтенд, возможно БД для разработки).
    *   Настройка CI/CD пайплайнов (например, GitHub Actions, GitLab CI) для автоматической сборки, тестирования и развертывания.
    *   Выбор и настройка хостинга/сервера.

**Рекомендации:**

*   **Итеративность:** Двигайтесь итеративно. Сначала реализуйте базовый функционал (например, просмотр заявок), а затем добавляйте более сложные фичи (фильтры, редактирование, файлы).
*   **Параллельная работа:** После завершения Этапа 1 (основа бэкенда и Auth), можно начинать Этап 3 (основа фронтенда) параллельно с Этапом 2 (основная логика заявок на бэкенде). Фронтенд может использовать моковые данные или ждать готовности API.
*   **Тесты:** Пишите тесты по ходу разработки, это сэкономит время на отладку в будущем.
*   **Документация API:** Держите документацию API (Swagger UI/OpenAPI, генерируемую FastAPI) в актуальном состоянии.