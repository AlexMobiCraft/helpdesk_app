# Описание API Эндпоинтов для проекта "Веб-приложение для службы технической поддержки" (Версия 1.1)

## Эндпоинты для Аутентификации

### 1. Вход пользователя (Получение JWT)

*   **Эндпоинт:** `/api/auth/login`
*   **HTTP-метод:** `POST`
*   **Описание:** Аутентификация пользователя по логину и паролю, возвращает JWT токен.
*   **Content-Type:** `application/x-www-form-urlencoded`
*   **Тело запроса (поля формы):**
    *   `username` (string, required): Имя пользователя.
    *   `password` (string, required): Пароль пользователя.
    *   *Примечание:* Стандарт OAuth2 также может включать поля `grant_type=password`, `scope`, `client_id`, `client_secret`, но для данной реализации FastAPI с `OAuth2PasswordRequestForm` достаточно `username` и `password`.
*   **Ответ (пример JSON):**
    ```json
    {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "bearer"
    }
    ```

### 2. Получение информации о текущем пользователе

*   **Эндпоинт:** `/api/users/me`
*   **HTTP-метод:** `GET`
*   **Описание:** Возвращает информацию о пользователе, которому принадлежит JWT токен из заголовка `Authorization`.
*   **Ответ (пример JSON):**
    ```json
    {
      "user_id": 789,
      "username": "ivanov",
      "email": "ivanov@example.com",
      "first_name": "Иван",
      "last_name": "Иванов",
      "role": "user",
      "department": "Бухгалтерия",
      "avatar_url": "/path/to/avatar.jpg",
      "created_at": "2025-01-15T10:00:00Z",
      "updated_at": "2025-01-16T11:30:00Z"
      // Другие поля пользователя, кроме password_hash
    }
    ```

## Описание API Эндпоинтов для Заявок (Tickets)

### 3. Создание заявки (для обычных пользователей)

*   **Эндпоинт:** `/api/tickets`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется для создания новой заявки пользователем. `user_id` пользователя, создающего заявку, определяется на сервере на основе JWT-токена в заголовке `Authorization`.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "device_id": 123, // ID устройства, предоставленный пользователем
      "description": "Не включается монитор",
      "priority_id": 1
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "ticket_id": 456, // ID генерируется сервером
      "device_id": 123,
      "user_id": 789,
      "description": "Не включается монитор",
      "priority_id": 1,
      "status_id": 1, // Начальный статус "Новая"
      "created_at": "2025-03-28T08:00:00Z",
      "updated_at": "2025-03-28T08:00:00Z",
      "closed_at": null,
      "resolution_notes": null,
      "files": [] // Добавлено поле для файлов
    }
    ```

### 4. Получение списка заявок

*   **Эндпоинт:** `/api/tickets`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения списка всех заявок. Поддерживает параметры для фильтрации, поиска, сортировки и пагинации. Требует аутентификации.
*   **Query-параметры (примеры):**
    *   `status_id={id}`: Фильтр по ID статуса.
    *   `priority_id={id}`: Фильтр по ID приоритета.
    *   `user_id={id}`: Фильтр по ID создателя заявки.
    *   `technician_id={id}`: Фильтр по ID назначенного техника.
    *   `device_id={id}`: Фильтр по ID устройства.
    *   `created_from=YYYY-MM-DD`, `created_to=YYYY-MM-DD`: Фильтр по дате создания.
    *   `search={текст}`: Полнотекстовый поиск по описанию заявки.
    *   `sort_by=created_at|updated_at|priority_id`: Поле для сортировки.
    *   `order=asc|desc`: Направление сортировки (по умолчанию `desc` для дат).
    *   `page={номер}`: Номер страницы (по умолчанию 1).
    *   `limit={количество}`: Количество заявок на странице (по умолчанию 20).
*   **Примеры запросов:**
    *   `/api/tickets?status_id=2&priority_id=3` // Статус "Ожидает решения", Приоритет "Высокий"
    *   `/api/tickets?technician_id=1001&sort_by=updated_at&order=asc` // Назначенные на техника 1001, сортировка по обновлению (старые вверху)
    *   `/api/tickets?search=монитор&page=2&limit=10` // Поиск по слову "монитор", вторая страница по 10 заявок
    *   `/api/tickets?user_id=789` // Получить заявки пользователя 789
*   **Ответ (пример JSON - список):**
    ```json
    [
      {
        "ticket_id": 456,
        "device_id": 123,
        "user_id": 789,
        "description": "Не включается монитор",
        "priority_id": 1,
        "status_id": 2,
        "created_at": "2025-03-28T08:00:00Z",
        "updated_at": "2025-03-28T08:15:00Z",
        "closed_at": null,
        "resolution_notes": null,
        "files": [] // Добавлено поле для файлов
        // Могут быть добавлены краткие данные о пользователе, статусе, приоритете
      },
      // ... другие заявки
    ]
    ```

### 5. Получение деталей конкретной заявки

*   **Эндпоинт:** `/api/tickets/{ticket_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения полной информации о заявке по ее уникальному идентификатору. Включает связанные данные.
*   **Пример запроса:** `/api/tickets/456`
*   **Ответ (пример JSON):**
    ```json
    {
      "ticket_id": 456,
      "device_id": 123,
      "user_id": 789,
      "description": "Не включается монитор",
      "priority_id": 1,
      "status_id": 2,
      "created_at": "2025-03-28T08:00:00Z",
      "updated_at": "2025-03-28T08:15:00Z",
      "closed_at": null,
      "resolution_notes": null, // Поле для заметок техника по решению
      "device": {
        "device_id": 123,
        "name": "Рабочий компьютер #1",
        "device_type_id": 3,
        "inventory_number": "INV-001"
      },
      "user": {
        "user_id": 789,
        "username": "ivanov",
        "email": "ivanov@example.com",
        "first_name": "Иван",
        "last_name": "Иванов"
      },
      "priority": {
        "priority_id": 1,
        "name": "Средний"
      },
      "status": {
        "status_id": 2,
        "name": "Ожидает решения"
      },
      "assigned_technicians": [
        {
          "assignment_id": 101,
          "technician": {
            "user_id": 1001,
            "username": "petrov",
            "email": "petrov@example.com",
            "first_name": "Петр",
            "last_name": "Петров"
          },
          "assigned_at": "2025-03-28T08:15:00Z"
        }
      ],
      "files": [
        {
          "file_id": 201,
          "file_name": "photo.jpg",
          "file_path": "/cloud/path/photo.jpg", // Или URL для скачивания
          "file_type": "image/jpeg",
          "file_size": 102400,
          "uploaded_at": "2025-03-28T08:05:00Z"
        }
      ]
    }
    ```

### 6. Обновление заявки (основные поля)

*   **Эндпоинт:** `/api/tickets/{ticket_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется для частичного обновления информации о существующей заявке (например, описание, приоритет). Права доступа зависят от роли (создатель может менять описание/приоритет до взятия в работу, техник/админ - приоритет и т.д.).
*   **Тело запроса (пример JSON):**
    ```json
    {
      "description": "Монитор не включается после обновления драйвера",
      "priority_id": 2 // Техник/Админ может сменить приоритет
    }
    ```
*   **Ответ:** Обновленный объект заявки (аналогично ответу на `GET`).

### 7. Обновление статуса заявки

*   **Эндпоинт:** `/api/tickets/{ticket_id}/status`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Специальный эндпоинт для обновления статуса заявки (например, техник берет в работу, закрывает). Устанавливает `updated_at`. При установке статуса "Закрыта", может устанавливать `closed_at`.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "status_id": 3 // "В работе"
    }
    ```
*   **Ответ:** Обновленный объект заявки, включая поле `files` (аналогично ответу на `GET /api/tickets/{ticket_id}`).

### 8. Назначение техника на заявку

*   **Эндпоинт:** `/api/tickets/{ticket_id}/assign`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется для назначения одного или нескольких техников на заявку (обычно менеджером или админом, возможно, самоназначение техником).
*   **Тело запроса (пример JSON):**
    ```json
    {
      "technician_ids": [1001, 1002]
    }
    ```
*   **Ответ:** Обновленный объект заявки, включая список назначенных техников и поле `files` (аналогично ответу на `GET /api/tickets/{ticket_id}`).

### 9. Удаление техника с заявки

*   **Эндпоинт:** `/api/tickets/{ticket_id}/unassign/{technician_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется для удаления конкретного техника с заявки.
*   **Ответ:** `204 No Content` или обновленный объект заявки.

### 10. Редактирование закрытой заявки (добавление заметок)

*   **Эндпоинт:** `/api/tickets/{ticket_id}/edit-closed`
*   **HTTP-метод:** `PATCH` (предпочтительно) / `PUT`
*   **Описание:** Используется техниками/админами для добавления/редактирования примечаний к решению (`resolution_notes`) в уже закрытых заявках. Убедитесь, что поле `resolution_notes` добавлено в структуру таблицы `tickets`.
*   **Тело запроса (пример PATCH JSON):**
    ```json
    {
      "resolution_notes": "Проблема решена заменой блока питания. Запчасть списана."
    }
    ```
*   **Ответ:** Обновленный объект заявки, включая поле `files` (аналогично ответу на `GET /api/tickets/{ticket_id}`).

### 11. Загрузка файла к заявке

*   **Эндпоинт:** `/api/tickets/{ticket_id}/files`
*   **HTTP-метод:** `POST`
*   **Описание:** Загрузка одного или нескольких файлов (фото, видео, документы) к существующей заявке. Требует прав пользователя (создателя заявки) или техника/администратора. Использует `multipart/form-data`.
*   **Тело запроса:** `multipart/form-data` с полем(ями) типа `file` (например, `files`).
*   **Ответ (пример JSON при успешной загрузке одного файла):**
    ```json
    {
      "file_id": 202,
      "ticket_id": 456,
      "file_name": "screenshot.png",
      "file_path": "/cloud/path/screenshot.png",
      "file_type": "image/png",
      "file_size": 51200,
      "uploaded_at": "2025-03-28T09:30:00Z"
    }
    ```
    (Может возвращать массив, если разрешена загрузка нескольких файлов одним запросом).

### 12. Удаление файла из заявки

*   **Эндпоинт:** `/api/tickets/{ticket_id}/files/{file_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Удаление файла, прикрепленного к заявке. Требует прав пользователя (создателя заявки) или техника/администратора.
*   **Ответ:** `204 No Content` при успехе.

### 13. Удаление заявки (только для администраторов)

*   **Эндпоинт:** `/api/tickets/{ticket_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администраторами для полного удаления заявки из системы.
*   **Тело запроса:** Нет.
*   **Ответ:** `204 No Content` при успешном удалении. `404 Not Found`, если заявка не найдена. `403 Forbidden`, если пользователь не администратор.

### 14. Создание заявки от имени пользователя (только для администраторов)

*   **Эндпоинт:** `/api/admin/tickets`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администраторами для создания новой заявки от имени указанного пользователя.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "device_id": 456,
      "description": "Проблема с принтером в бухгалтерии",
      "priority_id": 3,
      "user_id": 1011 // Явное указание ID пользователя
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "ticket_id": 457,
      "device_id": 456,
      "user_id": 1011,
      "description": "Проблема с принтером в бухгалтерии",
      "priority_id": 3,
      "status_id": 1,
      "created_at": "2025-03-28T20:29:00Z",
      "updated_at": "2025-03-28T20:29:00Z",
      "closed_at": null,
      "resolution_notes": null,
      "files": [] // Добавлено поле для файлов
    }
    ```

## Эндпоинты для Пользователей (Users)

### 15. Создание нового пользователя (только для администраторов)

*   **Эндпоинт:** `/api/admin/users`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для создания нового пользователя.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "username": "petrov",
      "password": "complexpassword", // Пароль должен хэшироваться на сервере
      "first_name": "Петр",
      "last_name": "Петров",
      "phone_number": "+79991234567",
      "role": "technician", // "admin", "technician", "user"
      "department": "ИТ Отдел",
      "avatar_url": null // или "/path/to/default_avatar.png",
      "email": "petrov@example.com"
    }
    ```
*   **Ответ:** Объект созданного пользователя (без пароля).

### 16. Получение списка пользователей (только для администраторов)

*   **Эндпоинт:** `/api/admin/users`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется администратором для получения списка всех пользователей с возможностью фильтрации и поиска.
*   **Query-параметры (примеры):**
    *   `role=user|technician|admin`: Фильтр по роли.
    *   `department={название}`: Фильтр по отделу.
    *   `search={текст}`: Поиск по `username` или `full_name`.
    *   `page={номер}`, `limit={количество}`: Пагинация.
*   **Ответ:** Массив объектов пользователей (без паролей).

### 17. Получение информации о конкретном пользователе (только для администраторов)

*   **Эндпоинт:** `/api/admin/users/{user_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется администратором для получения информации о пользователе по его ID.
*   **Ответ:** Объект пользователя (без пароля). (см. пример ответа #2, но доступен админу для любого `user_id`).

### 18. Обновление информации о пользователе

*   **Эндпоинт:** `/api/admin/users/{user_id}` (для админов) **ИЛИ** `/api/users/me` (для самого пользователя)
*   **HTTP-метод:** `PATCH` (предпочтительно) / `PUT`
*   **Описание:** Используется для обновления информации о пользователе. Администратор может обновлять данные любого пользователя через `/api/admin/users/{user_id}`. Пользователь может обновлять свои данные (кроме роли и, возможно, `username`) через `/api/users/me`.
*   **Тело запроса (пример PATCH для `/api/users/me`):**
    ```json
    {
      "first_name": "Иван Игоревич",
      "last_name": "Иванов",
      "phone_number": "+79111112233",
      "avatar_url": "/new/avatar.jpg",
      "email": "ivanov2@example.com"
    }
    ```
*   **Тело запроса (пример PATCH для `/api/admin/users/{user_id}`):**
    ```json
    {
      "role": "admin",
      "department": "Руководство"
    }
    ```
*   **Ответ:** Обновленный объект пользователя (без пароля).

### 19. Смена пароля текущим пользователем

*   **Эндпоинт:** `/api/users/me/password`
*   **HTTP-метод:** `PUT`
*   **Описание:** Позволяет аутентифицированному пользователю сменить свой пароль.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "current_password": "oldPassword123", // Текущий пароль для проверки
      "new_password": "newStrongPassword456" // Новый пароль
    }
    ```
*   **Ответ:** `204 No Content` при успехе.

### 20. Установка/Сброс пароля пользователя администратором

*   **Эндпоинт:** `/api/admin/users/{user_id}/password`
*   **HTTP-метод:** `PUT`
*   **Описание:** Позволяет администратору установить новый пароль для указанного пользователя.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "new_password": "temporaryPassword789" // Новый пароль для пользователя
    }
    ```
*   **Ответ:** `204 No Content` при успехе.

### 21. Удаление пользователя (только для администраторов)

*   **Эндпоинт:** `/api/admin/users/{user_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления пользователя по его ID.
*   **Пример запроса:** `/api/admin/users/1012`
*   **Ответ:** `204 No Content`.

## Эндпоинты для Ролей Пользователей (User Roles)

### 22. Создание роли (только для администраторов)

*   **Эндпоинт:** `/api/admin/roles`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для добавления новой роли пользователя.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "role_name": "manager", // Уникальное имя роли
      "description": "Менеджер службы поддержки" // Опциональное описание
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "role_id": 4, // ID генерируется сервером
      "role_name": "manager",
      "description": "Менеджер службы поддержки"
    }
    ```

### 23. Получение списка ролей (только для администраторов)

*   **Эндпоинт:** `/api/admin/roles`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется администратором для получения списка всех доступных ролей пользователей.
*   **Ответ (пример JSON):**
    ```json
    [
      { "role_id": 1, "role_name": "admin", "description": "Администратор системы" },
      { "role_id": 2, "role_name": "technician", "description": "Технический специалист" },
      { "role_id": 3, "role_name": "user", "description": "Обычный пользователь" },
      { "role_id": 4, "role_name": "manager", "description": "Менеджер службы поддержки" }
    ]
    ```

### 24. Получение информации о конкретной роли (только для администраторов)

*   **Эндпоинт:** `/api/admin/roles/{role_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется администратором для получения информации о роли по её ID.
*   **Ответ (пример JSON):**
    ```json
    {
      "role_id": 2,
      "role_name": "technician",
      "description": "Технический специалист"
    }
    ```

### 25. Обновление роли (только для администраторов)

*   **Эндпоинт:** `/api/admin/roles/{role_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администратором для обновления названия и/или описания роли.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "description": "Технический специалист (уровень 2)"
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "role_id": 2,
      "role_name": "technician",
      "description": "Технический специалист (уровень 2)"
    }
    ```

### 26. Удаление роли (только для администраторов)

*   **Эндпоинт:** `/api/admin/roles/{role_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления роли по её ID. (Осторожно: может быть запрещено, если есть связанные пользователи).
*   **Ответ:** `204 No Content`.

## Эндпоинты для Типов Устройств (Device Types)

### 27. Создание типа устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/device-types`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для добавления нового типа устройства.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Монитор"
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "device_type_id": 5, // ID генерируется сервером
      "name": "Монитор"
    }
    ```

### 28. Получение списка типов устройств

*   **Эндпоинт:** `/api/device-types`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения списка всех доступных типов устройств.
*   **Пример запроса:** `/api/device-types`
*   **Ответ (пример JSON):**
    ```json
    [
      { "device_type_id": 1, "name": "Весы" },
      { "device_type_id": 2, "name": "Термометр" },
      { "device_type_id": 3, "name": "Компьютер" },
      { "device_type_id": 4, "name": "Принтер" },
      { "device_type_id": 5, "name": "Монитор" }
    ]
    ```

### 29. Получение информации о конкретном типе устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/device-types/{device_type_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения информации о типе устройства по его ID.
*   **Пример запроса:** `/api/admin/device-types/3`
*   **Ответ (пример JSON):**
    ```json
    {
      "device_type_id": 3,
      "name": "Компьютер"
    }
    ```

### 30. Обновление типа устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/device-types/{device_type_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администратором для обновления названия типа устройства.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Персональный компьютер"
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "device_type_id": 3,
      "name": "Персональный компьютер"
    }
    ```

### 31. Удаление типа устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/device-types/{device_type_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления типа устройства по его ID. (Осторожно: может быть запрещено, если есть связанные устройства).
*   **Пример запроса:** `/api/admin/device-types/1`
*   **Ответ:** `204 No Content`.

## Эндпоинты для Устройств (Devices)

### 32. Создание устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/devices`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для добавления нового устройства. Администратор должен предоставить уникальный `device_id` (требование совместимости с существующей системой учета). Поле `device_type_id` является обязательным. `inventory_number` - опционально. (Примечание: Предоставление ID клиентом менее типично для REST API, чем генерация на сервере.).
*   **Тело запроса (пример JSON):**
    ```json
    {
      "device_id": 128, // ID предоставляется администратором
      "name": "Рабочий компьютер #5",
      "device_type_id": 3, // Ссылка на ID из /api/device-types
      "inventory_number": "INV-005"
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "device_id": 128, // Возвращается предоставленный ID
      "name": "Рабочий компьютер #5",
      "device_type_id": 3,
      "inventory_number": "INV-005"
    }
    ```

### 33. Получение списка устройств

*   **Эндпоинт:** `/api/devices`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения списка всех устройств, с возможностью фильтрации.
*   **Query-параметры (примеры):**
    *   `device_type_id={id}`: Фильтр по типу устройства.
    *   `search={текст}`: Поиск по названию или инвентарному номеру.
    *   `page={номер}`, `limit={количество}`: Пагинация.
*   **Примеры запросов:**
    *   `/api/devices?device_type_id=3` // Получить все компьютеры
    *   `/api/devices?search=INV-` // Получить устройства, инвентарный номер которых содержит "INV-"
*   **Ответ (пример JSON):**
    ```json
    [
      {
        "device_id": 123,
        "name": "Рабочий компьютер #1",
        "device_type_id": 3,
        "inventory_number": "INV-001"
        // Можно добавить объект device_type с названием типа
        // "device_type": { "device_type_id": 3, "name": "Компьютер" }
      },
      {
        "device_id": 124,
        "name": "Принтер HP LaserJet",
        "device_type_id": 4,
        "inventory_number": "PRN-010"
        // "device_type": { "device_type_id": 4, "name": "Принтер" }
      }
    ]
    ```

### 34. Получение информации о конкретном устройстве

*   **Эндпоинт:** `/api/devices/{device_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения информации об устройстве по его ID. Доступно всем аутентифицированным пользователям.
*   **Пример запроса:** `/api/devices/123`
*   **Ответ (пример JSON):**
    ```json
    {
      "device_id": 123,
      "name": "Рабочий компьютер #1",
      "device_type_id": 3,
      "inventory_number": "INV-001"
      // Можно добавить объект device_type
      // "device_type": { "device_type_id": 3, "name": "Компьютер" }
    }
    ```

### 35. Обновление устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/devices/{device_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администратором для обновления информации об устройстве.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Рабочий компьютер бухгалтерии",
      "inventory_number": "INV-BUH-01",
      "device_type_id": 3 // Тип можно изменить
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "device_id": 123,
      "name": "Рабочий компьютер бухгалтерии",
      "device_type_id": 3,
      "inventory_number": "INV-BUH-01"
    }
    ```

### 36. Удаление устройства (только для администраторов)

*   **Эндпоинт:** `/api/admin/devices/{device_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления устройства по его ID. (Осторожно: может быть запрещено, если есть связанные заявки).
*   **Пример запроса:** `/api/admin/devices/124`
*   **Ответ:** `204 No Content`.

## Эндпоинты для Приоритетов (Priorities)

### 37. Создание приоритета (только для администраторов)

*   **Эндпоинт:** `/api/admin/priorities`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для добавления нового приоритета.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Критический",
      "display_order": 0 // Чем меньше, тем выше в списке
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "priority_id": 4, // ID генерируется сервером
      "name": "Критический",
      "display_order": 0
    }
    ```

### 38. Получение списка приоритетов

*   **Эндпоинт:** `/api/priorities`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения списка всех доступных приоритетов, отсортированных по `display_order`.
*   **Ответ (пример JSON):**
    ```json
    [
      { "priority_id": 4, "name": "Критический", "display_order": 0 },
      { "priority_id": 3, "name": "Высокий", "display_order": 1 },
      { "priority_id": 2, "name": "Средний", "display_order": 2 },
      { "priority_id": 1, "name": "Низкий", "display_order": 3 }
    ]
    ```

### 39. Получение информации о конкретном приоритете (только для администраторов)

*   **Эндпоинт:** `/api/admin/priorities/{priority_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения информации о приоритете по его ID.
*   **Ответ (пример JSON):**
    ```json
    {
      "priority_id": 2,
      "name": "Средний",
      "display_order": 2
    }
    ```

### 40. Обновление приоритета (только для администраторов)

*   **Эндпоинт:** `/api/admin/priorities/{priority_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администратором для обновления названия и/или порядка отображения приоритета.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Очень высокий", // Переименовали "Высокий"
      "display_order": 1 // Оставили порядок
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "priority_id": 3,
      "name": "Очень высокий",
      "display_order": 1
    }
    ```

### 41. Удаление приоритета (только для администраторов)

*   **Эндпоинт:** `/api/admin/priorities/{priority_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления приоритета по его ID. (Осторожно: может быть запрещено, если есть связанные заявки).
*   **Ответ:** `204 No Content`.

## Эндпоинты для Статусов (Statuses)

### 42. Создание статуса (только для администраторов)

*   **Эндпоинт:** `/api/admin/statuses`
*   **HTTP-метод:** `POST`
*   **Описание:** Используется администратором для добавления нового статуса.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Отклонена",
      "display_order": 5
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "status_id": 5, // ID генерируется сервером
      "name": "Отклонена",
      "display_order": 5
    }
    ```

### 43. Получение списка статусов

*   **Эндпоинт:** `/api/statuses`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения списка всех доступных статусов, отсортированных по `display_order`.
*   **Ответ (пример JSON):**
    ```json
    [
      { "status_id": 1, "name": "Новая", "display_order": 1 },
      { "status_id": 2, "name": "Ожидает решения", "display_order": 2 },
      { "status_id": 3, "name": "В работе", "display_order": 3 },
      { "status_id": 4, "name": "Закрыта", "display_order": 4 }
      // { "status_id": 5, "name": "Отклонена", "display_order": 5 } // Если был создан
    ]
    ```

### 44. Получение информации о конкретном статусе (только для администраторов)

*   **Эндпоинт:** `/api/admin/statuses/{status_id}`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется для получения информации о статусе по его ID.
*   **Ответ (пример JSON):**
    ```json
    {
      "status_id": 3,
      "name": "В работе",
      "display_order": 3
    }
    ```

### 45. Обновление статуса (только для администраторов)

*   **Эндпоинт:** `/api/admin/statuses/{status_id}`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администратором для обновления названия и/или порядка отображения статуса.
*   **Тело запроса (пример JSON):**
    ```json
    {
      "name": "Решено", // Переименовали "Закрыта"
      "display_order": 4
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "status_id": 4,
      "name": "Решено",
      "display_order": 4
    }
    ```

### 46. Удаление статуса (только для администраторов)

*   **Эндпоинт:** `/api/admin/statuses/{status_id}`
*   **HTTP-метод:** `DELETE`
*   **Описание:** Используется администратором для удаления статуса по его ID. (Осторожно: может быть запрещено, если есть связанные заявки).
*   **Ответ:** `204 No Content`.

## Эндпоинты для Отчётов

### 47. Экспорт отчёта по заявкам

*   **Эндпоинт:** `/api/admin/reports/tickets`
*   **HTTP-метод:** `GET`
*   **Описание:** Используется администратором для выгрузки отчёта по заявкам. Поддерживает фильтры, аналогичные эндпоинту #4 (`GET /api/tickets`).
*   **Query-параметры:**
    *   `format=csv|xlsx`: Формат отчёта (по умолчанию `csv`).
    *   `status_id`, `priority_id`, `user_id`, `technician_id`, `device_id`, `created_from`, `created_to`, `search`: Параметры фильтрации данных для отчёта.
*   **Пример запроса:** `/api/admin/reports/tickets?format=csv&status_id=4&created_from=2025-03-01&created_to=2025-03-31` (Экспорт закрытых заявок за март в CSV).
*   **Ответ:** Файл отчёта в указанном формате (например, с `Content-Type: text/csv` или `Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`).

---

## Структуры Ответов при Ошибках

API должен возвращать стандартизированные ответы при возникновении ошибок, используя соответствующие HTTP статусы и тело ответа в формате JSON.

**Общая структура ошибки:**

```json
{
  "detail": "Краткое описание ошибки, понятное для разработчика или пользователя."
}

```

### 48. Изменение роли пользователя (только для администраторов)

*   **Эндпоинт:** `/api/admin/users/{user_id}/role`
*   **HTTP-метод:** `PATCH`
*   **Описание:** Используется администраторами для изменения роли пользователя (например, повышение обычного пользователя до техника или администратора).
*   **Тело запроса (пример JSON):**
    ```json
    {
      "role_id": 2
    }
    ```
*   **Ответ (пример JSON):**
    ```json
    {
      "user_id": 5,
      "username": "sidorov",
      "role": {
        "role_id": 2,
        "name": "technician",
        "description": "Технический специалист"
      },
      "updated_at": "2025-04-13T20:30:00Z"
    }
    ```